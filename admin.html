<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Photobooth Veteran 7680</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .filters {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group label {
            font-weight: 600;
            color: #333;
        }

        .filter-group select, .filter-group input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            min-width: 150px;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .gallery {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .photo-card {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .photo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .photo-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            display: block;
        }

        .photo-info {
            padding: 15px;
            background: #f8f9fa;
        }

        .photo-info .badge-tag {
            display: inline-block;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .photo-info .timestamp {
            color: #666;
            font-size: 0.85em;
        }

        .photo-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .photo-actions button {
            flex: 1;
            padding: 8px;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
        }

        .modal-content img {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 10px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group select, .filter-group input {
                width: 100%;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Admin Dashboard</h1>
            <p>Photobooth Veteran 7680 - Mall Balekota Tangerang</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Foto</h3>
                <div class="number" id="totalPhotos">0</div>
            </div>
            <div class="stat-card">
                <h3>Badge Terpopuler</h3>
                <div class="number" id="topBadge" style="font-size: 1.5em;">-</div>
            </div>
            <div class="stat-card">
                <h3>Portrait / Landscape</h3>
                <div class="number" id="orientation" style="font-size: 1.3em;">0 / 0</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <div class="filter-group">
                <label>Badge:</label>
                <select id="filterBadge">
                    <option value="all">Semua Badge</option>
                    <option value="None">Tanpa Badge</option>
                    <option value="Kalideres">Kalideres</option>
                    <option value="Ancild">Ancild</option>
                    <option value="Laser">Laser</option>
                    <option value="Djati">Djati</option>
                    <option value="Boemi">Boemi</option>
                    <option value="Kamlay">Kamlay</option>
                    <option value="Liobaroe">Liobaroe</option>
                    <option value="Cimone">Cimone</option>
                    <option value="Veroem">Veroem</option>
                </select>

                <label>Orientasi:</label>
                <select id="filterOrientation">
                    <option value="all">Semua</option>
                    <option value="portrait">Portrait</option>
                    <option value="landscape">Landscape</option>
                </select>

                <label>Cari:</label>
                <input type="text" id="searchInput" placeholder="Cari badge atau waktu...">

                <button class="btn btn-primary" onclick="loadPhotos()">üîç Filter</button>
                <button class="btn btn-success" onclick="window.open('slideshow.html', '_blank')">üé¨ Buka Slideshow</button>
            </div>
        </div>

        <!-- Gallery -->
        <div class="gallery">
            <div class="gallery-header">
                <h2>üì∏ Gallery Foto</h2>
                <button class="btn btn-success" onclick="downloadAll()">‚¨áÔ∏è Download Semua</button>
            </div>
            <div id="galleryContent">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Memuat foto...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal" id="imageModal">
        <button class="modal-close" onclick="closeModal()">‚úï</button>
        <div class="modal-content">
            <img id="modalImage" src="" alt="Full size">
        </div>
    </div>

    <script>
        // GANTI INI DENGAN URL GOOGLE APPS SCRIPT ANDA
        const API_URL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgJo8boHOVhyk-Z2Pq19JidLCvUKCVZvS4BXfjpkWvXr-alycaEkDBJEwG5bmiv7AA6b-BwFplDxF9ciUlrBgeOl1-CsKYM27zgDe0YQBc-PUhhizvjQFFuUJ53BpLQhkukkBnbC-U21x351ziNoFSf5AoB3P0Y-DdLKxUyv34NpYJMFNOBH6EsGG3t5JT-tl9Eo3chCsH6JPBD6mlHdGSY1pAj99mwpPhkLP__5D8lZnnaht8gfmDR9KXIc6DyoeXmuJ-lT8T6v_4Pom33FXglgtkFTg&lib=MWHjdJ_V6OUz-Txpvu-zqZvQJNMt8nwjv';

        let allPhotos = [];

        // Load photos from API
        async function loadPhotos() {
            const badge = document.getElementById('filterBadge').value;
            const orientation = document.getElementById('filterOrientation').value;
            const search = document.getElementById('searchInput').value;

            const params = new URLSearchParams({
                action: 'list',
                badge: badge,
                orientation: orientation,
                search: search
            });

            try {
                const response = await fetch(`${API_URL}?${params}`);
                const data = await response.json();

                if (data.success) {
                    allPhotos = data.photos;
                    displayPhotos(allPhotos);
                    loadStats();
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('Gagal memuat foto: ' + error.message);
            }
        }

        // Display photos in gallery
        function displayPhotos(photos) {
            const container = document.getElementById('galleryContent');

            if (photos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <h3>Belum ada foto</h3>
                        <p>Foto yang diambil akan muncul di sini</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '<div class="gallery-grid" id="galleryGrid"></div>';
            const grid = document.getElementById('galleryGrid');

            photos.forEach(photo => {
                const card = document.createElement('div');
                card.className = 'photo-card';
                card.innerHTML = `
                    <img src="${photo.thumbnailUrl}" alt="Photo" onclick="openModal('${photo.url}')">
                    <div class="photo-info">
                        <span class="badge-tag">${photo.badge}</span>
                        <div class="timestamp">${formatDate(photo.timestamp)}</div>
                        <div class="photo-actions">
                            <button class="btn btn-success" onclick="downloadPhoto('${photo.url}')">
                                ‚¨áÔ∏è Download
                            </button>
                            <button class="btn btn-danger" onclick="deletePhoto('${photo.photoId}')">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}?action=stats`);
                const data = await response.json();

                if (data.success) {
                    const stats = data.stats;

                    document.getElementById('totalPhotos').textContent = stats.total;

                    // Top badge
                    const badges = Object.entries(stats.byBadge);
                    if (badges.length > 0) {
                        badges.sort((a, b) => b[1] - a[1]);
                        document.getElementById('topBadge').textContent = badges[0][0];
                    }

                    // Orientation
                    const portrait = stats.byOrientation.portrait || 0;
                    const landscape = stats.byOrientation.landscape || 0;
                    document.getElementById('orientation').textContent = `${portrait} / ${landscape}`;
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Delete photo
        async function deletePhoto(photoId) {
            if (!confirm('Yakin ingin menghapus foto ini?')) return;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'delete',
                        photoId: photoId
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert('Foto berhasil dihapus!');
                    loadPhotos();
                } else {
                    alert('Gagal menghapus foto: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Download single photo
        function downloadPhoto(url) {
            const link = document.createElement('a');
            link.href = url;
            link.download = `photo_${Date.now()}.jpg`;
            link.target = '_blank';
            link.click();
        }

        // Download all photos
        function downloadAll() {
            alert('Fitur download semua foto dalam ZIP sedang dalam pengembangan. Untuk saat ini, download foto satu per satu.');
        }

        // Open modal
        function openModal(url) {
            document.getElementById('modalImage').src = url;
            document.getElementById('imageModal').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('id-ID', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Show error
        function showError(message) {
            document.getElementById('galleryContent').innerHTML = `
                <div class="empty-state">
                    <h3 style="color: #ff4757;">‚ùå Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        // Close modal on click outside
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Load photos on page load
        window.addEventListener('load', () => {
            if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                showError('‚ö†Ô∏è Harap setup Google Apps Script URL terlebih dahulu!');
            } else {
                loadPhotos();
            }
        });

        // Auto refresh every 30 seconds
        setInterval(loadPhotos, 30000);
    </script>
</body>
</html>